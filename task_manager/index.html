<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Hub | PAF-IAST</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* PAF-IAST / Academic Color Palette */
            --primary: #9f1239; /* Deep Rose Red */
            --primary-light: #be123c;
            --secondary: #1e293b; /* Slate Dark */
            --accent: #f43f5e;
            --background: #f1f5f9;
            --white: #ffffff;
            --text-dark: #0f172a;
            --text-gray: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        
        body { background-color: var(--background); color: var(--text-dark); overflow-x: hidden; }

        /* --- UTILITIES --- */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .btn { padding: 12px 24px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-light); transform: translateY(-1px); }
        .btn-outline { border: 2px solid var(--primary); color: var(--primary); background: transparent; }

        /* --- LOGIN / LANDING LAYOUT --- */
        .auth-wrapper {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #fff1f2 0%, #ffe4e6 100%);
            padding: 20px;
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 24px;
            width: 100%;
            max-width: 900px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
            display: flex;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .auth-left { flex: 1; padding-right: 40px; border-right: 1px solid #e2e8f0; }
        .auth-right { flex: 1; padding-left: 40px; display: flex; flex-direction: column; justify-content: center; text-align: center; }

        .logo-area { display: flex; align-items: center; gap: 10px; margin-bottom: 30px; }
        .logo-icon { width: 40px; height: 40px; background: var(--primary); border-radius: 8px; color: white; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--secondary); }
        .input-group input { width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; transition: 0.3s; background: #f8fafc; }
        .input-group input:focus { border-color: var(--primary); outline: none; background: white; }

        /* --- DASHBOARD LAYOUT (The Hub) --- */
        .dashboard-wrapper { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--secondary);
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }

        .sidebar-header { display: flex; align-items: center; gap: 10px; padding-bottom: 30px; border-bottom: 1px solid #334155; margin-bottom: 20px; }
        .nav-item {
            padding: 14px 16px;
            margin-bottom: 5px;
            border-radius: 10px;
            cursor: pointer;
            color: #94a3b8;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: 0.2s;
        }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.1); color: white; }
        .nav-item i { width: 20px; text-align: center; }

        /* Main Content */
        .main-content { margin-left: 280px; flex: 1; padding: 30px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .user-profile { display: flex; align-items: center; gap: 15px; }
        .avatar { width: 40px; height: 40px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; }
        .stat-card h3 { font-size: 0.9rem; color: var(--text-gray); margin-bottom: 10px; }
        .stat-card .value { font-size: 2rem; font-weight: 700; color: var(--text-dark); }
        .stat-card .trend { font-size: 0.85rem; color: var(--success); display: flex; align-items: center; gap: 5px; margin-top: 5px; }

        /* Module: Assignments (Tasks) */
        .module-card { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); }
        
        .task-input-row { display: flex; gap: 15px; margin-bottom: 25px; background: #f8fafc; padding: 15px; border-radius: 12px; }
        
        .task-list { margin-top: 20px; }
        .task-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 16px; border-bottom: 1px solid #f1f5f9; transition: 0.2s;
        }
        .task-row:hover { background: #f8fafc; }
        .priority-badge { padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
        .p-high { background: #fee2e2; color: #991b1b; }
        .p-medium { background: #ffedd5; color: #9a3412; }
        .p-low { background: #dcfce7; color: #166534; }

        /* Coming Soon Placeholder */
        .placeholder-card {
            background: white; border-radius: 20px; padding: 50px; text-align: center;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); border: 2px dashed #e2e8f0;
        }
        .placeholder-card i { color: #cbd5e1; margin-bottom: 20px; }
        .placeholder-card h2 { color: var(--secondary); margin-bottom: 10px; }

        /* Toast */
        #toast {
            position: fixed; bottom: 30px; right: 30px;
            background: var(--secondary); color: white;
            padding: 16px 24px; border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
            transform: translateY(200%); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000; display: flex; align-items: center; gap: 12px; font-weight: 500;
        }
        #toast.active { transform: translateY(0); }

        @media (max-width: 768px) {
            .auth-card { flex-direction: column; }
            .auth-right { padding: 30px 0 0 0; display: none; } /* Hide decorative side on mobile */
            .sidebar { width: 70px; padding: 20px 10px; }
            .sidebar-text { display: none; }
            .main-content { margin-left: 70px; }
            .task-input-row { flex-direction: column; }
        }
    </style>
</head>
<body>

    <div id="toast"><i class="fas fa-check-circle"></i><span id="toastMsg">Action Successful</span></div>

    <div id="authView" class="auth-wrapper fade-in">
        <div class="auth-card">
            <div class="auth-left">
                <div class="logo-area">
                    <div class="logo-icon"><i class="fas fa-university"></i></div>
                    <div>
                        <h2 style="font-size: 1.2rem; font-weight: 700; color: var(--secondary);">Campus Hub</h2>
                        <span style="font-size: 0.8rem; color: var(--text-gray);">PAF-IAST Secure Portal</span>
                    </div>
                </div>

                <div id="loginForm">
                    <h1 style="font-size: 1.8rem; margin-bottom: 10px;">Student Login</h1>
                    <p style="color: var(--text-gray); margin-bottom: 30px;">Access your dashboard, assignments, and hostel records.</p>
                    <form onsubmit="handleLogin(event)">
                        <div class="input-group">
                            <label>Student Email</label>
                            <input type="email" id="loginEmail" placeholder="student@paf-iast.edu.pk" required>
                        </div>
                        <div class="input-group">
                            <label>Password</label>
                            <input type="password" id="loginPass" placeholder="Enter your password" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Sign In to Portal</button>
                    </form>
                    <p style="margin-top: 20px; font-size: 0.9rem;">
                        New Student? <a href="#" onclick="toggleAuth('register')" style="color: var(--primary); font-weight: 600;">Register ID</a>
                    </p>
                </div>

                <div id="registerForm" class="hidden">
                    <h1 style="font-size: 1.8rem; margin-bottom: 10px;">Student Registration</h1>
                    <p style="color: var(--text-gray); margin-bottom: 30px;">Create your secure academic profile.</p>
                    <form onsubmit="handleRegister(event)">
                        <div class="input-group">
                            <label>Full Name</label>
                            <input type="text" id="regName" placeholder="e.g. Ali Khan" required>
                        </div>
                        <div class="input-group">
                            <label>Email Address</label>
                            <input type="email" id="regEmail" placeholder="student@paf-iast.edu.pk" required>
                        </div>
                        <div class="input-group">
                            <label>Create Password</label>
                            <input type="password" id="regPass" required>
                        </div>
                        <button type="submit" class="btn btn-primary" id="regBtn" style="width: 100%;">Create Account</button>
                    </form>
                    <p style="margin-top: 20px; font-size: 0.9rem;">
                        Already registered? <a href="#" onclick="toggleAuth('login')" style="color: var(--primary); font-weight: 600;">Back to Login</a>
                    </p>
                </div>
            </div>

            <div class="auth-right" style="background: linear-gradient(135deg, var(--secondary) 0%, #0f172a 100%); color: white; padding: 40px; border-radius: 16px;">
                <h2 style="color: white; margin-bottom: 15px;">Secure Multi-Module Platform</h2>
                <ul style="text-align: left; margin: 0 auto; display: inline-block; list-style: none;">
                    <li style="margin-bottom: 15px;"><i class="fas fa-check-circle" style="color: var(--success); margin-right: 10px;"></i> Student Info Management</li>
                    <li style="margin-bottom: 15px;"><i class="fas fa-check-circle" style="color: var(--success); margin-right: 10px;"></i> Assignment Tracking</li>
                    <li style="margin-bottom: 15px;"><i class="fas fa-check-circle" style="color: var(--success); margin-right: 10px;"></i> Hostel & Event Services</li>
                    <li style="margin-bottom: 15px;"><i class="fas fa-check-circle" style="color: var(--success); margin-right: 10px;"></i> Secure Authentication</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="dashboardView" class="dashboard-wrapper hidden">
        <nav class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-university fa-lg"></i>
                <span class="sidebar-text" style="font-weight: 700; font-size: 1.1rem;">Campus Hub</span>
            </div>
            
            <div class="nav-item active" onclick="switchPage('page-dashboard', this, 'Student Dashboard')">
                <i class="fas fa-th-large"></i> <span class="sidebar-text">Dashboard</span>
            </div>
            <div class="nav-item" onclick="switchPage('page-student', this, 'Student Information')">
                <i class="fas fa-user-graduate"></i> <span class="sidebar-text">Student Info</span>
            </div>
            <div class="nav-item" onclick="switchPage('page-events', this, 'Events & Schedule')">
                <i class="fas fa-calendar-alt"></i> <span class="sidebar-text">Events & Schedule</span>
            </div>
            <div class="nav-item" onclick="switchPage('page-hostel', this, 'Hostel Services')">
                <i class="fas fa-bed"></i> <span class="sidebar-text">Hostel Services</span>
            </div>
            <div class="nav-item" onclick="switchPage('page-assignments', this, 'Assignments')">
                <i class="fas fa-book-open"></i> <span class="sidebar-text">Assignments</span>
            </div>
            <div class="nav-item" onclick="switchPage('page-complaints', this, 'Complaint Center')">
                <i class="fas fa-exclamation-circle"></i> <span class="sidebar-text">Complaints</span>
            </div>
            
            <div style="margin-top: auto;">
                <div class="nav-item" onclick="logout()" style="color: #f87171;">
                    <i class="fas fa-sign-out-alt"></i> <span class="sidebar-text">Secure Logout</span>
                </div>
            </div>
        </nav>

        <main class="main-content">
            <div class="header">
                <div>
                    <h1 id="welcomeHeader">Student Dashboard</h1>
                    <p style="color: var(--text-gray);">Overview of your academic progress</p>
                </div>
                <div class="user-profile">
                    <div style="text-align: right;">
                        <div id="userNameDisplay" style="font-weight: 700;">Student Name</div>
                        <div style="font-size: 0.8rem; color: var(--text-gray);">BS Software Engineering</div>
                    </div>
                    <div class="avatar" id="userInitials">SK</div>
                </div>
            </div>

            <div id="page-dashboard" class="page-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h3>CGPA</h3>
                                <div class="value">3.12</div>
                            </div>
                            <i class="fas fa-chart-line fa-2x" style="color: var(--primary); opacity: 0.2;"></i>
                        </div>
                        <div class="trend"><i class="fas fa-arrow-up"></i> Top 20% of class</div>
                    </div>
                    <div class="stat-card">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h3>Attendance</h3>
                                <div class="value">92%</div>
                            </div>
                            <i class="fas fa-user-clock fa-2x" style="color: var(--success); opacity: 0.2;"></i>
                        </div>
                        <div class="trend">Good Standing</div>
                    </div>
                    <div class="stat-card">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h3>Pending Assignments</h3>
                                <div class="value" id="pendingCount">0</div>
                            </div>
                            <i class="fas fa-tasks fa-2x" style="color: var(--warning); opacity: 0.2;"></i>
                        </div>
                        <div class="trend" style="color: var(--warning);">Due this week</div>
                    </div>
                </div>
            </div>

            <div id="page-student" class="page-section hidden">
                <div class="placeholder-card">
                    <i class="fas fa-user-graduate fa-4x"></i>
                    <h2>Student Information</h2>
                    <p>This module is currently under development. <br> Check back soon for detailed academic records.</p>
                </div>
            </div>

            <div id="page-events" class="page-section hidden">
                <div class="placeholder-card">
                    <i class="fas fa-calendar-alt fa-4x"></i>
                    <h2>Events & Schedule</h2>
                    <p>Class schedules and university events will appear here soon.</p>
                </div>
            </div>

            <div id="page-hostel" class="page-section hidden">
                <div class="placeholder-card">
                    <i class="fas fa-bed fa-4x"></i>
                    <h2>Hostel Services</h2>
                    <p>Room allocation and mess management features are coming soon.</p>
                </div>
            </div>

            <div id="page-assignments" class="page-section hidden">
                <div class="module-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2><i class="fas fa-laptop-code" style="color: var(--primary); margin-right: 10px;"></i> Academic Assignments</h2>
                        <button class="btn btn-outline" style="font-size: 0.9rem;" onclick="loadTasks()"><i class="fas fa-sync"></i> Refresh</button>
                    </div>

                    <div class="task-input-row">
                        <div style="flex: 2;">
                            <input type="text" id="taskTitle" placeholder="Assignment Title (e.g. Web Dev Project)" 
                                   style="width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px;">
                        </div>
                        <div style="flex: 1;">
                            <input type="date" id="taskDate" style="width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px;">
                        </div>
                        <div style="flex: 1;">
                            <select id="taskPriority" style="width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px;">
                                <option value="high">High Priority</option>
                                <option value="medium" selected>Medium Priority</option>
                                <option value="low">Low Priority</option>
                            </select>
                        </div>
                        <button onclick="addTask()" class="btn btn-primary" style="flex: 0 0 100px;">
                            <i class="fas fa-plus"></i> Add
                        </button>
                    </div>

                    <div style="border-bottom: 1px solid #e2e8f0; margin-bottom: 15px;">
                        <button class="btn" style="background:none; border-bottom: 2px solid var(--primary); color: var(--primary);">Current Tasks</button>
                        <button class="btn" style="background:none; color: var(--text-gray);">Completed</button>
                        <button class="btn" style="background:none; color: var(--text-gray);">Archived</button>
                    </div>

                    <div id="taskList" class="task-list">
                        <div style="text-align: center; padding: 40px; color: #94a3b8;">
                            <i class="fas fa-spinner fa-spin fa-2x"></i> Loading Data...
                        </div>
                    </div>
                </div>
            </div>

            <div id="page-complaints" class="page-section hidden">
                <div class="placeholder-card">
                    <i class="fas fa-exclamation-circle fa-4x"></i>
                    <h2>Complaint Center</h2>
                    <p>Admin support and complaint tracking features are working soon.</p>
                </div>
            </div>

        </main>
    </div>

    <script>
        const API_URL = 'http://localhost/task_manager/api';
        let currentUser = JSON.parse(localStorage.getItem('campusHubUser'));

        // --- Initialization ---
        if(currentUser) {
            initDashboard();
        } else {
            document.getElementById('authView').classList.remove('hidden');
        }

        function toggleAuth(view) {
            document.getElementById('loginForm').classList.toggle('hidden', view === 'register');
            document.getElementById('registerForm').classList.toggle('hidden', view === 'login');
        }

        function showToast(msg, type='success') {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // --- PAGE SWITCHING LOGIC (NEW) ---
        function switchPage(pageId, navItem, title) {
            // 1. Hide all page sections
            const pages = document.querySelectorAll('.page-section');
            pages.forEach(page => page.classList.add('hidden'));

            // 2. Show the selected page
            document.getElementById(pageId).classList.remove('hidden');

            // 3. Update Sidebar Active State
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            navItem.classList.add('active');

            // 4. Update Header Title
            document.getElementById('welcomeHeader').innerText = title;
        }

        // --- AUTHENTICATION API ---
        async function handleRegister(e) {
            e.preventDefault();
            const btn = document.getElementById('regBtn');
            btn.disabled = true;
            btn.innerHTML = 'Processing...';

            const payload = {
                name: document.getElementById('regName').value,
                email: document.getElementById('regEmail').value,
                password: document.getElementById('regPass').value
            };

            try {
                const res = await fetch(`${API_URL}/register.php`, {
                    method: 'POST', body: JSON.stringify(payload)
                });
                const data = await res.json();
                
                if(res.ok) {
                    showToast('Registration Successful! Please Login.');
                    toggleAuth('login');
                    // clear forms
                    document.getElementById('regName').value = '';
                    document.getElementById('regEmail').value = '';
                    document.getElementById('regPass').value = '';
                } else {
                    showToast(data.error, 'error');
                }
            } catch(err) { showToast('Server Connection Error', 'error'); } 
            finally { btn.disabled = false; btn.innerText = 'Create Account'; }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const payload = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPass').value
            };

            try {
                const res = await fetch(`${API_URL}/login.php`, {
                    method: 'POST', body: JSON.stringify(payload)
                });
                const data = await res.json();

                if(res.ok) {
                    currentUser = data.user;
                    localStorage.setItem('campusHubUser', JSON.stringify(currentUser));
                    initDashboard();
                } else {
                    showToast(data.error, 'error');
                }
            } catch(err) { showToast('Server Connection Error', 'error'); }
        }

        function logout() {
            localStorage.removeItem('campusHubUser');
            location.reload();
        }

        // --- DASHBOARD LOGIC ---
        function initDashboard() {
            document.getElementById('authView').classList.add('hidden');
            document.getElementById('dashboardView').classList.remove('hidden');
            document.getElementById('dashboardView').classList.add('fade-in');
            
            // Set User Info
            document.getElementById('userNameDisplay').innerText = currentUser.name;
            document.getElementById('userInitials').innerText = currentUser.name.substring(0,2).toUpperCase();
            
            loadTasks();
        }

        async function loadTasks() {
            const list = document.getElementById('taskList');
            try {
                const res = await fetch(`${API_URL}/tasks.php?user_id=${currentUser.id}`);
                const tasks = await res.json();
                
                // Update stats
                const pending = tasks.filter(t => t.completed == 0).length;
                document.getElementById('pendingCount').innerText = pending;

                list.innerHTML = '';
                if(tasks.length === 0) {
                    list.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #cbd5e1;">
                            <i class="fas fa-clipboard-check fa-3x" style="margin-bottom:15px"></i>
                            <p>No active assignments. You're all caught up!</p>
                        </div>`;
                    return;
                }

                tasks.forEach(task => {
                    const isDone = task.completed == 1;
                    const div = document.createElement('div');
                    div.className = 'task-row';
                    if(isDone) div.style.opacity = '0.5';

                    div.innerHTML = `
                        <div style="display:flex; align-items:center; gap: 15px; flex: 1;">
                            <div style="background:${isDone ? '#10b981' : '#f1f5f9'}; width:10px; height:10px; border-radius:50%;"></div>
                            <div>
                                <div style="font-weight:600; font-size:1.05rem; ${isDone ? 'text-decoration:line-through' : ''}">${task.title}</div>
                                <div style="font-size:0.85rem; color:#64748b;">
                                    Due: ${task.due_date} 
                                    <span class="priority-badge p-${task.priority}" style="margin-left:10px">${task.priority}</span>
                                </div>
                            </div>
                        </div>
                        <div style="display:flex; gap: 10px;">
                            <button onclick="toggleTask(${task.id}, ${task.completed})" class="btn" style="padding: 8px 12px; background: ${isDone ? '#f59e0b' : '#10b981'}; color:white;">
                                <i class="fas ${isDone ? 'fa-undo' : 'fa-check'}"></i>
                            </button>
                            <button onclick="deleteTask(${task.id})" class="btn" style="padding: 8px 12px; background: #ef4444; color:white;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    list.appendChild(div);
                });

            } catch(err) { console.error(err); }
        }

        async function addTask() {
            const title = document.getElementById('taskTitle').value;
            const date = document.getElementById('taskDate').value;
            const priority = document.getElementById('taskPriority').value;

            if(!title || !date) return showToast('Please enter title and date', 'error');

            await fetch(`${API_URL}/tasks.php`, {
                method: 'POST',
                body: JSON.stringify({
                    user_id: currentUser.id,
                    title, due_date: date, priority
                })
            });
            
            document.getElementById('taskTitle').value = '';
            showToast('Assignment Added');
            loadTasks();
        }

        async function toggleTask(id, status) {
            await fetch(`${API_URL}/tasks.php`, {
                method: 'PUT',
                body: JSON.stringify({
                    user_id: currentUser.id, task_id: id, completed: status == 1 ? 0 : 1
                })
            });
            loadTasks();
        }

        async function deleteTask(id) {
            if(!confirm('Remove this record?')) return;
            await fetch(`${API_URL}/tasks.php`, {
                method: 'DELETE',
                body: JSON.stringify({ user_id: currentUser.id, task_id: id })
            });
            loadTasks();
            showToast('Record Deleted');
        }
    </script>
</body>
</html>